#!perl -lp0
@V=/\d+-.*/g;@T=/\d+,.*/g;@M=$T[0]=~/\d+/g;$m=0 x s!!$t=$&;($z=join'',map{1&grep
$t<$_+$|--,//g}@V)=~1or$c+=$t;$z!ge,/$m/||(@R=($r=$r&$_||$_)=~//g)for@T;$_=$R[
++$i%@R]&~$m,s/\01/$&/g-1||($.*="@-">5||$M[$i%@R],$m|=$_)while$m=~0;$_="$c $."
